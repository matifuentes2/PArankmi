base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
base %>%
distinct(title) %>%
nrow()
dos <- base %>%
distinct(title) %>%
nrow()
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
"))
uno <- trash_surveys(base, "title") %>%
distinct(title) %>%
nrow()
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
"))
uno <- trash_surveys(base, "title") %>%
distinct(title)
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
dos %>%
filter(!title %in% uno$title)
dos <- base %>%
distinct(title)
dos %>%
filter(!title %in% uno$title)
trash_surveys <- function(df, var, query = F){
omisiones <-   c("zergey","marian","test","piloto","prueba","archivar","copia",
"eliminar","demo","toma de","no func","malo","dado de baja"
,"carolina","clima danna","clima jesus")
if(query == F){
output <- df %>%
filter(str_length(!!sym(var)) > 1) %>%
filter(!str_detect(!!sym(var), regex(paste(omisiones,collapse = "|"), ignore_case = T)))
}
else{
output = "and length({var}) > 1 "
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
}
return(output)
}
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
trash_surveys <- function(df, var, query = F){
omisiones <-   c("zergey","marian","test","piloto","prueba","archivar","copia",
"eliminar","demo","toma de","no func","malo","dado de baja"
,"carolina","clima danna","clima jesus")
if(query == F){
output <- df %>%
filter(str_length(!!sym(var)) > 1) %>%
filter(!str_detect(!!sym(var), regex(paste(omisiones,collapse = "|"), ignore_case = T)))
}
else{
output = glue::glue("and length({var}) > 1 ")
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
}
return(output)
}
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
dos %>%
filter(!title %in% uno$title)
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
dos %>%
filter(!title %in% uno$title)
output = glue::glue("and length({var}) > 2 ")
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
trash_surveys <- function(df, var, query = F){
omisiones <-   c("zergey","marian","test","piloto","prueba","archivar","copia",
"eliminar","demo","toma de","no func","malo","dado de baja"
,"carolina","clima danna","clima jesus")
if(query == F){
output <- df %>%
filter(str_length(!!sym(var)) > 1) %>%
filter(!str_detect(!!sym(var), regex(paste(omisiones,collapse = "|"), ignore_case = T)))
}
else{
output = glue::glue("and length({var}) > 2 ")
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
}
return(output)
}
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
dos %>%
filter(!title %in% uno$title)
trash_surveys <- function(df, var, query = F){
omisiones <-   c("zergey","marian","test","piloto","prueba","archivar","copia",
"eliminar","demo","toma de","no func","malo","dado de baja"
,"carolina","clima danna","clima jesus")
if(query == F){
output <- df %>%
filter(str_length(!!sym(var)) > 1) %>%
filter(!str_detect(!!sym(var), regex(paste(omisiones,collapse = "|"), ignore_case = T)))
}
else{
output = glue::glue("and {var} not '.'")
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
}
return(output)
}
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
trash_surveys <- function(df, var, query = F){
omisiones <-   c("zergey","marian","test","piloto","prueba","archivar","copia",
"eliminar","demo","toma de","no func","malo","dado de baja"
,"carolina","clima danna","clima jesus")
if(query == F){
output <- df %>%
filter(str_length(!!sym(var)) > 1) %>%
filter(!str_detect(!!sym(var), regex(paste(omisiones,collapse = "|"), ignore_case = T)))
}
else{
output = glue::glue("and {var} is not '.'")
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
}
return(output)
}
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
trash_surveys <- function(df, var, query = F){
omisiones <-   c("zergey","marian","test","piloto","prueba","archivar","copia",
"eliminar","demo","toma de","no func","malo","dado de baja"
,"carolina","clima danna","clima jesus")
if(query == F){
output <- df %>%
filter(str_length(!!sym(var)) > 1) %>%
filter(!str_detect(!!sym(var), regex(paste(omisiones,collapse = "|"), ignore_case = T)))
}
else{
output = glue::glue("and {var} != '.'")
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
}
return(output)
}
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
dos %>%
filter(!title %in% uno$title)
trash_surveys <- function(df, var, query = F){
omisiones <-   c("zergey","marian","test","piloto","prueba","archivar","copia",
"eliminar","demo","toma de","no func","malo","dado de baja"
,"carolina","clima danna","clima jesus")
if(query == F){
output <- df %>%
filter(str_length(!!sym(var)) > 1) %>%
filter(!str_detect(!!sym(var), regex(paste(omisiones,collapse = "|"), ignore_case = T)))
}
else{
output = glue::glue("and {var} != '     .'")
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
}
return(output)
}
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
dos %>%
filter(!title %in% uno$title)
trash_surveys <- function(df, var, query = F){
omisiones <-   c("zergey","marian","test","piloto","prueba","archivar","copia",
"eliminar","demo","toma de","no func","malo","dado de baja"
,"carolina","clima danna","clima jesus")
if(query == F){
output <- df %>%
filter(str_length(!!sym(var)) > 1) %>%
filter(!str_detect(!!sym(var), regex(paste(omisiones,collapse = "|"), ignore_case = T)))
}
else{
output = glue::glue("and length({var}) > 1")
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
}
return(output)
}
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
dos %>%
filter(!title %in% uno$title)
dos %>%
filter(!title %in% uno$title) %>%
print()
dos %>%
filter(!title %in% uno$title) %>%
.[[1,1]]
trash_surveys <- function(df, var, query = F){
omisiones <-   c("zergey","marian","test","piloto","prueba","archivar","copia",
"eliminar","demo","toma de","no func","malo","dado de baja"
,"carolina","clima danna","clima jesus")
if(query == F){
output <- df %>%
filter(str_length(!!sym(var)) > 1) %>%
filter(!str_detect(!!sym(var), regex(paste(omisiones,collapse = "|"), ignore_case = T)))
}
else{
output = glue::glue("and {var} <> '.'")
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
}
return(output)
}
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
dos %>%
filter(!title %in% uno$title) %>%
.[[1,1]]
trash_surveys <- function(df, var, query = F){
omisiones <-   c("zergey","marian","test","piloto","prueba","archivar","copia",
"eliminar","demo","toma de","no func","malo","dado de baja"
,"carolina","clima danna","clima jesus")
if(query == F){
output <- df %>%
filter(str_length(!!sym(var)) > 1) %>%
filter(!str_detect(!!sym(var), regex(paste(omisiones,collapse = "|"), ignore_case = T)))
}
else{
output = glue::glue("and {var} <> .")
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
}
return(output)
}
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
trash_surveys <- function(df, var, query = F){
omisiones <-   c("zergey","marian","test","piloto","prueba","archivar","copia",
"eliminar","demo","toma de","no func","malo","dado de baja"
,"carolina","clima danna","clima jesus")
if(query == F){
output <- df %>%
filter(str_length(!!sym(var)) > 1) %>%
filter(!str_detect(!!sym(var), regex(paste(omisiones,collapse = "|"), ignore_case = T)))
}
else{
output = glue::glue("and {var} <> '.'")
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
}
return(output)
}
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
dos <- base %>%
distinct(title)
dos %>%
filter(!title %in% uno$title) %>%
.[[1,1]]
dos %>%
filter(!title %in% uno$title)
trash_surveys <- function(df, var, query = F){
omisiones <-   c("zergey","marian","test","piloto","prueba","archivar","copia",
"eliminar","demo","toma de","no func","malo","dado de baja"
,"carolina","clima danna","clima jesus")
if(query == F){
output <- df %>%
filter(str_length(!!sym(var)) > 1) %>%
filter(!str_detect(!!sym(var), regex(paste(omisiones,collapse = "|"), ignore_case = T)))
}
else{
output = glue::glue("and length({var}) > 1")
for (i in 1:length(omisiones)){
output <- paste(output, glue::glue("and {var} not ilike '%{omisiones[[i]]}%'"))
}
}
return(output)
}
base <- DBI::dbGetQuery(con, glue::glue("select s.title
from survey_dimensions sd
left join dimensions d on d.id = sd.dimension_id
left join surveys s on s.id = sd.survey_id
left join enterprise_processes ep on ep.id = s.enterprise_process_id
left join dimension_levels dl on dl.dimension_id = d.id
where ep.rankmi_module_id = 3
and d.dimension_type = 'item'
and dl.evaluation_type_label_id is not null
and s.survey_type = 0
{trash_surveys(var = 's.title', query = T)}
"))
dos <- base %>%
distinct(title)
dos %>%
filter(!title %in% uno$title) %>%
.[[1,1]]
dos %>%
filter(!title %in% uno$title)
setwd(here::here())
devtools::document()
setwd("..")
devtools::install("PArankmi")
PArankmi::trash_surveys(var = "s.title",query = F)
setwd(here::here())
devtools::document()
setwd("..")
devtools::install("PArankmi")
PArankmi::trash_surveys(var = "s.title",query = F)
PArankmi::trash_surveys(var = "s.title",query = T)
if(query == F){
output <- sort(enterprises)}
enterprises <- c("Acme Corp", "Avengers","CompuMundo Hiper Mega Red", "Wayne Enterprises","Empresa de prueba", "EmpresaPrueba", "Empresa test", "Enaex DEMO", "Stark Industries", "Customer Success Demos", "Llevepan","BBVAdemo","BCP Demo","Clientes Rankmi","Co op","Empresas ACME", "Fortuna Silver Mines", "Fortuna Silver Mines 2","Manuelita", "Only app", "prueba", "Red", "Rankmi Test", "Sales Manager","test creacion","Test intercom 1","test org chart","tyrell","Tyrell Corp.")
paste(enterprises, collapse = ",")
paste(enterprises, collapse = "','")
paste("'",paste(enterprises, collapse = "','"),"'")
str_c("'",paste(enterprises, collapse = "','"),"'")
setwd(here::here())
devtools::document()
setwd("..")
devtools::install("PArankmi")
setwd(here::here())
devtools::document()
setwd("..")
devtools::install("PArankmi")
# devtools::install_git("https://github.com/matifuentes2/PArankmi")
setwd(here::here())
devtools::document()
setwd("..")
devtools::install("PArankmi")
setwd(here::here())
devtools::document()
setwd("..")
devtools::install("PArankmi")
setwd(here::here())
devtools::document()
setwd("..")
devtools::install("PArankmi")
?PArankmi::trash_surveys()
?PArankmi::trash_enterprises()
devtools::install_git("https://github.com/matifuentes2/PArankmi")
library(DBI)
con <- DBI::dbConnect(odbc::odbc(), Driver = "PostgreSQL Unicode",
Database = glue::glue("rankmi_global"), Servername = glue::glue("127.0.0.1"),
Port = glue::glue(5556), UserName = glue::glue("rankmi_database"),
Password = glue::glue("_R1nkm3D1t1b1s3_2019"))
devtools::install_git("https://github.com/matifuentes2/PArankmi")
PArankmi::trash_surveys()
PArankmi::trash_surveys
